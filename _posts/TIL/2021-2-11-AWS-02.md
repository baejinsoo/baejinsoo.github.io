---
title: "íŒŒì´ì¬ìœ¼ë¡œ S3 ë²„í‚·ì— íŒŒì¼ ì—…ë¡œë“œí•˜ê¸°(boto3)"
excerpt: "í”„ë¡œì íŠ¸ ê´€ë¦¬í•˜ê¸°"
categories:
  - aws
last_modified_at: 2021-02-11
toc: true
toc_sticky: true
---

## Pythonìœ¼ë¡œ S3 ë²„í‚·ì— íŒŒì¼ ì—…ë¡œë“œí•˜ê¸°(boto3)

> ì§„í–‰í–ˆì—ˆë˜ í”„ë¡œì íŠ¸ë¥¼ ê´€ë¦¬í•˜ë©´ì„œ ì•„í‚¤í…ì²˜ë¥¼ ìˆ˜ì •í•´ë³´ì•˜ë‹¤.
>
> ê¸°ì¡´ì—ëŠ” ìœ íŠœë¸Œì—ì„œ ìŒì•…ì„ ë‹¤ìš´ë°›ìœ¼ë©´, mp3 íŒŒì¼ê³¼ ê°€ìˆ˜ ì´ë¯¸ì§€ë“¤ì„ ë¡œì»¬ í´ë”ì— ì €ì¥í•´ë‘ì—ˆìœ¼ë‚˜, ì´ ë°©ë²•ì€ ì¢‹ì§€ ì•Šì€ ë°©ë²•ì´ê¸°ì— s3 ë²„í‚·ì— ì—…ë¡œë“œí•˜ëŠ” ë°©ì‹ìœ¼ë¡œ í•˜ê²Œë˜ì—ˆë‹¤.

### boto3 ì‚¬ìš©í•˜ê¸°

> `pip install boto3` ë¡œ ì„¤ì¹˜ë¶€í„° í•´ì¤€ë‹¤.
>
> ë‘ ê°€ì§€ ë°©ë²•ìœ¼ë¡œ ì´ë¯¸ì§€ë¥¼ s3 ë²„í‚·ì— ì—…ë¡œë“œ í•´ë³´ê² ë‹¤.

##### 1. boto3.resource() ì‚¬ìš© - img íŒŒì¼ ì—…ë¡œë“œ

```python
import boto3
from botocore.client import Config

ACCESS_KEY_ID = 'ì‹œí¬ë¦¿ í‚¤ ì•„ì´ë”” ì…ë ¥' #s3 ê´€ë ¨ ê¶Œí•œì„ ê°€ì§„ IAMê³„ì • ì •ë³´
ACCESS_SECRET_KEY = 'ì‹œí¬ë¦¿ í‚¤ ì…ë ¥'
BUCKET_NAME = 'ë²„í‚· ì´ë¦„ ì…ë ¥'

def handle_upload_img(f): # f = íŒŒì¼ëª…
    data = open('plist/static/plist/img/artist/'+f+'.jpg', 'rb')
    # 'ë¡œì»¬ì˜ í•´ë‹¹íŒŒì¼ê²½ë¡œ'+ íŒŒì¼ëª… + í™•ì¥ì
    s3 = boto3.resource(
        's3',
        aws_access_key_id=ACCESS_KEY_ID,
        aws_secret_access_key=ACCESS_SECRET_KEY,
        config=Config(signature_version='s3v4')
    )
    s3.Bucket(BUCKET_NAME).put_object(
        Key=f, Body=data, ContentType='image/jpg')
```

> ìœ„ì˜ ë°©ì‹ëŒ€ë¡œ s3 ë²„í‚·ì— ì—…ë¡œë“œëœ ê²°ê³¼ì´ë‹¤.

![image](https://user-images.githubusercontent.com/17541671/107557076-80c1ca00-6c1c-11eb-9b93-b55d802aa4a9.png)

> íŒŒì¼ì„ í¼ë¸”ë¦­ìœ¼ë¡œ ì„¤ì •í•´ë‘ë©´ ê°ì²´ URLë¡œ ì ‘ì†í•´ì„œ ì´ë¯¸ì§€ë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
>
> í•´ë‹¹ urlë¡œ ì›¹ì‚¬ì´íŠ¸ì—ì„œ ì´ë¯¸ì§€ë¥¼ í™•ì¸í•˜ëŠ” ê²ƒì´ ê°€ëŠ¥í•˜ë‹¤.
>
> ì—…ë¡œë“œëœ ì´ë¯¸ì§€ë¥¼ ìë™ìœ¼ë¡œ í¼ë¸”ë¦­ìœ¼ë¡œ ì„¤ì •í•˜ëŠ” ë°©ë²•ì€ ì•„ë˜ì— ê²Œì‹œí•´ë‘ì—ˆë‹¤.

![image](https://user-images.githubusercontent.com/17541671/107557478-047bb680-6c1d-11eb-8889-5fd460b353e9.png)

> ì¶œì²˜: ì´ë¯¸ì§€ëŠ” ë©œë¡ ì—ì„œ ë‚˜ì–¼ë‹˜ ì‚¬ì§„ì„ ê°€ì ¸ì˜¨ ê²ë‹ˆë‹¤..



##### 2. boto3.client() ì‚¬ìš© - mp3 íŒŒì¼, img íŒŒì¼ ì—…ë¡œë“œ

```python
import boto3

ACCESS_KEY_ID = 'ì‹œí¬ë¦¿ í‚¤ ì•„ì´ë”” ì…ë ¥' #s3 ê´€ë ¨ ê¶Œí•œì„ ê°€ì§„ IAMê³„ì • ì •ë³´
ACCESS_SECRET_KEY = 'ì‹œí¬ë¦¿ í‚¤ ì…ë ¥'
BUCKET_NAME = 'ë²„í‚· ì´ë¦„ ì…ë ¥'

def handle_upload_mp3(f):
    s3_client = boto3.client('s3',
                            aws_access_key_id=ACCESS_KEY_ID,
                            aws_secret_access_key=ACCESS_SECRET_KEY)
    response = s3_client.upload_file(
        'plist/static/plist/audio/'+f+'.mp3', BUCKET_NAME, 'audio/'+f+'.mp3')

def handle_upload_img(f): # f = íŒŒì¼ëª…
	s3_client = boto3.client(
        		's3',
                aws_access_key_id=ACCESS_KEY_ID,
                aws_secret_access_key=ACCESS_SECRET_KEY
    		)
	response = s3_client.upload_file(
    'plist/static/plist/img/artist/'+f+'.jpg', BUCKET_NAME, 'img/'+f+'.jpg')
    # ë¡œì»¬íŒŒì¼ê²½ë¡œ + íŒŒì¼ëª… + íŒŒì¼ì¢…ë¥˜, ë²„í‚·ëª…, s3ë²„í‚·ì˜ ì›í•˜ëŠ”ê²½ë¡œ + íŒŒì¼ëª… + íŒŒì¼ì¢…ë¥˜
```

> ìœ„ì˜ ë°©ë²•ìœ¼ë¡œ ì´ë¯¸ì§€ê°€ ì„±ê³µì ìœ¼ë¡œ ì—…ë¡œë“œëœ ëª¨ìŠµì´ë‹¤
>
> client ë°©ë²•ì„ ì‚¬ìš©í•˜ë©´ ë²„í‚·ì— í´ë”ë¥¼ ë§Œë“¤ì–´ì„œ ê·¸ ì•ˆì— íŒŒì¼ì„ ì €ì¥í•˜ê¸°ì— ìš©ì´í•˜ë‹¤.

![image](https://user-images.githubusercontent.com/17541671/107556246-84088600-6c1b-11eb-9cc7-b3a24ef4d4a1.png)

> í•˜ì§€ë§Œ ì´ ë°©ì‹ìœ¼ë¡œ ì—…ë¡œë“œí•˜ê²Œë˜ë©´ urlì—ì„œ ì´ë¯¸ì§€ë¥¼ ë°”ë¡œ ë³´ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ urlì— ì ‘ì†í•˜ê²Œë˜ë©´ ì•„ë˜ì™€ ê°™ì´ í•´ë‹¹ ì´ë¯¸ì§€ë¥¼ ì €ì¥ í•  ìˆ˜ ìˆë‹¤ê³  í™•ì¸í•  ìˆ˜ ìˆë‹¤.

![image](https://user-images.githubusercontent.com/17541671/107557778-5f151280-6c1d-11eb-8574-cf7b8892e0e7.png)



### S3 ë²„í‚· ì„¤ì •

#### ì—…ë¡œë“œëœ ì´ë¯¸ì§€ ìë™ í¼ë¸”ë¦­ìœ¼ë¡œ ì„¤ì •í•˜ê¸°

`ë²„í‚·` ì„ íƒ ğŸ‘‰ `ê¶Œí•œ` ì„ íƒ ğŸ‘‰ `ë²„í‚· ì •ì±…` `í¸ì§‘`ì„ íƒ

> jsonìœ¼ë¡œ ì‘ì„±ëœ ë²„í‚· ì •ì±…ì€ ë²„í‚·ì— ì €ì¥ëœ ê°ì²´ì— ëŒ€í•œ ì•¡ì„¸ìŠ¤ ê¶Œí•œì„ ì œê³µí•œë‹¤,

```
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "StatementSid1",
            "Effect": "Allow",
            "Principal": {
                "AWS": "arn:aws:iam::0000000000000:user/{IAM user ì´ë¦„}"
            },
            "Action": [
                "s3:GetObject",
                "s3:PutObject",
                "s3:DeleteObject"
            ],
            "Resource": "arn:aws:s3:::{ë²„í‚·ì´ë¦„}/*"
        },
        {
            "Sid": "StatementSid2",
            "Effect": "Allow",
            "Principal": "*",
            "Action": "s3:GetObject",
            "Resource": "arn:aws:s3:::{ë²„í‚·ì´ë¦„}/*"
        }
    ]
}
```



### ì—…ë¡œë“œëœ ì´ë¯¸ì§€ì™€ mp3íŒŒì¼ë¥¼ í”„ë¡œì íŠ¸ì— ë°˜ì˜í•œ ëª¨ìŠµ

![image](https://user-images.githubusercontent.com/17541671/107558975-cb444600-6c1e-11eb-8e36-fc6b9a9793e2.png)

```
<-- ì´ë¯¸ì§€, mp3 ì¬ìƒí™”ë©´ html ê´€ë ¨ ì†ŒìŠ¤ì½”ë“œ -->
<img src="https://ë²„í‚·url/{{ song.song_thumbnail }}.jpg" alt="">

<audio autoplay="autoplay" loop="loop" preload="auto" controls="controls">
	<source src="https://ë²„í‚·url/{{song.song_title}}.mp3">
</audio>
```

